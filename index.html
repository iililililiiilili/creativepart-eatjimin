<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>밥먹자! 안지민</title>
  <style>
    body {
      background-color: #f0f0f0;
      font-size: 16px;
      margin: 0;
      padding: 20px;
      color: #333;
    }
    canvas {
      display: block;
      margin: 0 auto;
      background-color: #fff;
      border: 1px solid #ccc;
      border-radius: 12px;
    }
    #subtitle, #score {
      text-align: center;
    }
    #subtitle {
      font-size: 20px;
    }
    #score {
      font-size: 40px;
      font-weight: bold;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <p id="subtitle">밥먹자! 안지민</p>
  <p id="score">현재점수: 0</p>
  <main><canvas id="canvas"></canvas></main>

  <script>
    const CANVAS_WIDTH = 800, CANVAS_HEIGHT = 500;
    const RUNNER_WIDTH = 100, RUNNER_HEIGHT = 100;
    const RUNNER_START_X = 10, RUNNER_START_Y = 400;
    const JUMP_SPEED = 6, MAX_JUMP_HEIGHT = 20;

    const ASSETS = {
      title: './background/title.png',
      startBtn: './background/gamestart.png',
      runnerSit: './character/jimin-sit.png',
      runnerFly: './character/jimin-fly.png',
      runnerCrash: './character/jimin-crash.png'
    };

    window.onload = () => {
      const canvas = document.getElementById('canvas');
      const ctx = canvas.getContext('2d');
      canvas.width = CANVAS_WIDTH;
      canvas.height = CANVAS_HEIGHT;

      let gameStarted = false;
      let jump = false;
      let runnerY = RUNNER_START_Y;

      const scoreText = document.getElementById('score');
      scoreText.textContent = '현재점수: 0';

      const titleImage = new Image();
      const startBtnImage = new Image();
      const runnerSit = new Image();
      const runnerFly = new Image();

      let imagesLoaded = 0;
      const totalImages = 2;

      const onImageLoaded = () => {
        imagesLoaded++;
        if (imagesLoaded === totalImages) {
          drawStartScreen();
        }
      };

      titleImage.onload = onImageLoaded;
      startBtnImage.onload = onImageLoaded;

      titleImage.src = ASSETS.title;
      startBtnImage.src = ASSETS.startBtn;
      runnerSit.src = ASSETS.runnerSit;
      runnerFly.src = ASSETS.runnerFly;

      function drawStartScreen() {
        ctx.clearRect(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT);
        ctx.drawImage(titleImage, 0, 0, CANVAS_WIDTH, CANVAS_HEIGHT);
        ctx.drawImage(startBtnImage, (CANVAS_WIDTH - 200) / 2, (CANVAS_HEIGHT + 100) / 2, 200, 100);
      }

      function animate() {
        requestAnimationFrame(animate);
        ctx.clearRect(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT);

        if (jump && runnerY > MAX_JUMP_HEIGHT) {
          runnerY -= JUMP_SPEED;
        } else if (!jump && runnerY < RUNNER_START_Y) {
          runnerY += JUMP_SPEED;
        }

        const runnerImage = jump || runnerY < RUNNER_START_Y ? runnerFly : runnerSit;
        ctx.drawImage(runnerImage, RUNNER_START_X, runnerY, RUNNER_WIDTH, RUNNER_HEIGHT);
      }

      canvas.addEventListener('click', e => {
        if (!gameStarted) {
          const rect = canvas.getBoundingClientRect();
          const x = e.clientX - rect.left;
          const y = e.clientY - rect.top;
          const btnX = (CANVAS_WIDTH - 200) / 2;
          const btnY = (CANVAS_HEIGHT + 100) / 2;

          if (x >= btnX && x <= btnX + 200 && y >= btnY && y <= btnY + 100) {
            gameStarted = true;
            animate();
          }
        }
      });

      document.addEventListener('keydown', e => {
        if (e.code === 'Space') jump = true;
      });

      document.addEventListener('keyup', e => {
        if (e.code === 'Space') jump = false;
      });
    };
  </script>
</body>
</html>
